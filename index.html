<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Animal Sort Flick v2.4</title>
    <style>
        * { box-sizing: border-box; }
        html, body { 
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: #f0f0f0; font-family: sans-serif; color: #333; 
            overflow: hidden; position: fixed; touch-action: none;
        }
        
        /* Â∫ÉÂëäÊû†Ôºö‰∏ä‰∏ã150pxÂõ∫ÂÆö */
        #ad-top, #ad-bottom { 
            position: absolute; left: 0; width: 100%; height: 150px; 
            background: #333; z-index: 1000; display: flex; align-items: center; justify-content: center;
        }
        #ad-top { top: 0; }
        #ad-bottom { bottom: 0; }
        iframe { border: none; width: 100%; height: 100%; }

        /* „Ç≤„Éº„É†Êú¨‰ΩìÔºöÂ∫ÉÂëä„ÅÆÈ´ò„ÅïÂàÜ(150px„Åö„Å§)„ÇíÂº∑Âà∂ÊéíÈô§ */
        #main-container {
            position: absolute;
            top: 150px; bottom: 150px; left: 0; right: 0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: #f0f0f0; z-index: 10;
        }

        #score-ui { position: absolute; top: 10px; font-size: 20px; font-weight: bold; }
        
        /* ‰∏≠Â§Æ„Çø„Éº„Ç≤„ÉÉ„Éà */
        #target-card {
            width: 140px; height: 140px; background: white; border-radius: 20px;
            display: flex; align-items: center; justify-content: center;
            font-size: 75px; box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            z-index: 20; transition: transform 0.15s ease-out, opacity 0.15s;
        }

        .guide { position: absolute; top: 50%; transform: translateY(-50%); font-size: 32px; font-weight: bold; opacity: 0.15; pointer-events: none; }
        #left-guide { left: 15px; color: #ff6b6b; text-align: center; }
        #right-guide { right: 15px; color: #4ecdc4; text-align: center; }

        /* „É°„Éã„É•„Éº/„Ç≤„Éº„É†„Ç™„Éº„Éê„ÉºÁîªÈù¢ */
        #menuScreen { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(255,255,255,0.98); display: flex; flex-direction: column; 
            align-items: center; justify-content: center; z-index: 200; padding: 10px; gap: 10px;
        }

        #ad-middle-container { 
            width: 300px; height: 250px; background: #ddd; display: none; 
            justify-content: center; align-items: center; flex-shrink: 0;
        }
        
        .btn-group { display: flex; flex-direction: column; align-items: center; gap: 10px; width: 100%; }
        .menu-btn { 
            padding: 12px 0; font-size: 16px; border: none; border-radius: 50px; 
            color: white; font-weight: bold; cursor: pointer; text-decoration: none; 
            width: 220px; text-align: center;
        }
        #goButton { background: #333; }
        .link-btn { background: #ff4081; }
        .best-info { color: #555; font-weight: bold; }
    </style>
</head>
<body>
    <div id="ad-top"><iframe src="ad.html" id="frame-top"></iframe></div>

    <div id="main-container">
        <div id="score-ui">TIME: 10.0 | SCORE: 0</div>
        
        <div id="left-guide" class="guide">üê∂<br>Â∑¶</div>
        <div id="target-card">Ôºü</div>
        <div id="right-guide" class="guide">Âè≥<br>üê±</div>

        <div id="menuScreen">
            <div id="menuHeader" style="text-align:center;">
                <h2 id="menuTitle" style="color:#333; margin:0; font-size: 24px;">ANIMAL SORT</h2>
                <div class="best-info">BEST: <span id="best-ui">0</span></div>
            </div>

            <div id="ad-middle-container">
                <script src="https://adm.shinobi.jp/s/1e6de436ea850948e238e975a93767eb"></script>
            </div>

            <div class="btn-group" id="btnGroup">
                <button id="goButton" class="menu-btn">GAME START</button>
                <a href="https://saaaachi.github.io/Hungry-Animal/" class="menu-btn link-btn">‰ªñ„ÅÆ„Ç≤„Éº„É†„ÅØ„Åì„Å°„Çâ</a>
            </div>
        </div>
    </div>

    <div id="ad-bottom"><iframe src="ad.html" id="frame-bottom"></iframe></div>

    <script>
        const targetCard = document.getElementById("target-card"),
              scoreUi = document.getElementById("score-ui"),
              menuScreen = document.getElementById("menuScreen"),
              menuTitle = document.getElementById("menuTitle"),
              menuHeader = document.getElementById("menuHeader"),
              bestUi = document.getElementById("best-ui"),
              goButton = document.getElementById("goButton"),
              adMid = document.getElementById("ad-middle-container"),
              btnGroup = document.getElementById("btnGroup"),
              mainContainer = document.getElementById("main-container");

        let score = 0, bestScore = localStorage.getItem("animal_sort_best") || 0;
        let currentType = "", gameActive = false, timeLeft = 10, timer, startX = 0;

        window.onload = () => { bestUi.innerText = bestScore; };

        goButton.onclick = () => {
            menuScreen.style.display = "none";
            adMid.style.display = "none";
            menuHeader.style.display = "block";
            gameActive = true;
            score = 0;
            timeLeft = 10;
            nextAnimal();
            startTimer();
        };

        function nextAnimal() {
            currentType = Math.random() > 0.5 ? "dog" : "cat";
            targetCard.innerText = currentType === "dog" ? "üê∂" : "üê±";
            targetCard.style.transition = "none";
            targetCard.style.transform = "translateX(0) scale(1) rotate(0deg)";
            targetCard.style.opacity = "1";
            setTimeout(() => { targetCard.style.transition = "transform 0.15s ease-out, opacity 0.15s"; }, 10);
        }

        // Â∫ÉÂëä„Ç®„É™„Ç¢Â§ñÔºàmain-containerÔºâ„Åß„ÅÆ„Åø„Éï„É™„ÉÉ„ÇØ„ÇíÊ§úÁü•
        mainContainer.addEventListener("touchstart", (e) => {
            if(!gameActive) return;
            startX = e.touches[0].clientX;
        });

        mainContainer.addEventListener("touchend", (e) => {
            if(!gameActive) return;
            let diffX = e.changedTouches[0].clientX - startX;

            if (Math.abs(diffX) > 40) {
                const choice = diffX < 0 ? "dog" : "cat";
                targetCard.style.transform = `translateX(${diffX > 0 ? 200 : -200}px) rotate(${diffX > 0 ? 20 : -20}deg) scale(0.5)`;
                targetCard.style.opacity = "0";
                setTimeout(() => checkAnswer(choice), 100);
            }
        });

        function checkAnswer(choice) {
            if(!gameActive) return;
            if(choice === currentType) {
                score++;
                timeLeft += 0.4;
                nextAnimal();
            } else {
                timeLeft -= 1.5;
                nextAnimal();
                mainContainer.style.background = "#ffcfcf";
                setTimeout(() => mainContainer.style.background = "#f0f0f0", 100);
            }
        }

        function startTimer() {
            if(timer) clearInterval(timer);
            timer = setInterval(() => {
                if(!gameActive) return;
                timeLeft -= 0.1;
                scoreUi.innerText = `TIME: ${Math.max(0, timeLeft).toFixed(1)} | SCORE: ${score}`;
                if(timeLeft <= 0) gameOver();
            }, 100);
        }

        function gameOver() {
            gameActive = false;
            clearInterval(timer);
            if(score > bestScore) {
                bestScore = score;
                localStorage.setItem("animal_sort_best", bestScore);
                bestUi.innerText = bestScore;
            }
            menuTitle.innerText = "TIME UP!";
            menuTitle.style.color = "#f44336";
            menuHeader.style.display = "none"; // Â∫ÉÂëä„Çπ„Éö„Éº„ÇπÁ¢∫‰øù
            goButton.innerText = "RETRY";

            btnGroup.style.opacity = "0";
            btnGroup.style.pointerEvents = "none";
            adMid.style.display = "flex"; 
            menuScreen.style.display = "flex";

            setTimeout(() => {
                btnGroup.style.opacity = "1";
                btnGroup.style.pointerEvents = "auto";
            }, 600);
        }

        setInterval(() => {
            document.querySelectorAll('iframe').forEach(f => {
                const s = f.src; f.src = "about:blank"; setTimeout(() => f.src = s, 100);
            });
        }, 30000);
    </script>
</body>
</html>
